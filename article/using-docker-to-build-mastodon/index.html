<!DOCTYPE html><html lang=zh-CN><head><title>ä½¿ç”¨ Docker æ­å»º Mastodon - Shiuxã®Blog</title><meta charset=UTF-8><meta name=keywords content=""><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=5"><link rel="shortcut icon" href=/logo.svg type=image/x-icon><meta name=description content="ä¸ºä»€ä¹ˆå¼€å§‹ä½¿ç”¨ Docker æ­å»ºå®ä¾‹ å¼€å§‹ä½¿ç”¨ Docker çº¯å±ä¸€ä¸ªæ‰‹æ®‹æ„å¤–å¯¼è‡´çš„é˜´å·®é˜³é”™ï¼šæˆ‘ä¸å°å¿ƒåœ¨å‡çº§æ—¶æŒ‰äº† DigitalOcean é¢æ¿é‡Œçš„ â€œå…³é—­æœåŠ¡å™¨â€ æŒ‰é’®ï¼Œç›¸å½“äºè·‘ç€ç¨‹åºçªç„¶æ‹”äº†ä¸»æœºç”µæºï¼Œå¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨å‡ºç°å¤§å‹ç½¢å·¥ã€‚æœ€åç”±å…”å­å¸®ï¼ˆä»£ï¼‰åŠ©ï¼ˆåŠ³ï¼‰æˆ‘è¿ç§»äº†ç«™ç‚¹ï¼Œæ–¹ä¾¿èµ·è§éƒ¨ç½²åœ¨äº† Docker ä¸Šã€‚äºæ˜¯åœ¨æ­¤ä¹Ÿæé†’å„ä½ï¼Œæƒ³è¦å…³é—­ Mastodon æœåŠ¡ï¼Œä¸€å®šè¦ä½¿ç”¨ systemctl s"><meta property=og:type content=article><meta property=og:title content="ä½¿ç”¨ Docker æ­å»º Mastodon"><meta property=og:url content=https://blog.shiux.com/article/using-docker-to-build-mastodon/index.html><meta property=og:site_name content=Shiuxã®Blog><meta property=og:description content="ä¸ºä»€ä¹ˆå¼€å§‹ä½¿ç”¨ Docker æ­å»ºå®ä¾‹ å¼€å§‹ä½¿ç”¨ Docker çº¯å±ä¸€ä¸ªæ‰‹æ®‹æ„å¤–å¯¼è‡´çš„é˜´å·®é˜³é”™ï¼šæˆ‘ä¸å°å¿ƒåœ¨å‡çº§æ—¶æŒ‰äº† DigitalOcean é¢æ¿é‡Œçš„ â€œå…³é—­æœåŠ¡å™¨â€ æŒ‰é’®ï¼Œç›¸å½“äºè·‘ç€ç¨‹åºçªç„¶æ‹”äº†ä¸»æœºç”µæºï¼Œå¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨å‡ºç°å¤§å‹ç½¢å·¥ã€‚æœ€åç”±å…”å­å¸®ï¼ˆä»£ï¼‰åŠ©ï¼ˆåŠ³ï¼‰æˆ‘è¿ç§»äº†ç«™ç‚¹ï¼Œæ–¹ä¾¿èµ·è§éƒ¨ç½²åœ¨äº† Docker ä¸Šã€‚äºæ˜¯åœ¨æ­¤ä¹Ÿæé†’å„ä½ï¼Œæƒ³è¦å…³é—­ Mastodon æœåŠ¡ï¼Œä¸€å®šè¦ä½¿ç”¨ systemctl s"><meta property=og:locale content=zh_CN><meta property=og:image content=https://s1.ax1x.com/2020/07/22/U7oZrR.png><meta property=og:image content=https://s1.ax1x.com/2020/07/22/U7TYpF.png><meta property=og:image content=https://s1.ax1x.com/2020/07/22/U7T79S.png><meta property=og:image content=https://s1.ax1x.com/2020/07/23/UXkujS.png><meta property=article:published_time content=2021-08-28T11:50:13.000Z><meta property=article:modified_time content=2023-06-30T02:35:39.001Z><meta property=article:author content=Shiux><meta property=article:tag content=Docker><meta name=twitter:card content=summary><meta name=twitter:image content=https://s1.ax1x.com/2020/07/22/U7oZrR.png><link rel=stylesheet href=/lib/fancybox/fancybox.css><link rel=stylesheet href=/lib/mdui_043tiny/mdui.css><link rel=stylesheet href="/lib/iconfont/iconfont.css?v=1688092602354"><link rel=stylesheet href="/css/style.css?v=1688092602354"><link rel=stylesheet href="/custom.css?v=1688092602354"><script src=/lib/mdui_043tiny/mdui.js async></script><script src=/lib/fancybox/fancybox.umd.js async></script><script async src="/js/app.js?v=1688092602354"></script><meta name=generator content="Hexo 6.3.0"></head><body class=mdui-drawer-body-left><div id=nexmoe-background><div class=nexmoe-bg style="background-image:url(https://api.btstu.cn/sjbz/api.php?lx=dongman&format=images)"></div><div class="mdui-appbar mdui-shadow-0"><div class=mdui-toolbar><a mdui-drawer="{target: '#drawer', swipe: true}" title=menu class="mdui-btn mdui-btn-icon mdui-ripple"><i class="mdui-icon nexmoefont icon-menu"></i></a><div class=mdui-toolbar-spacer></div><a href=/ title=Shiux class="mdui-btn mdui-btn-icon"><img src=/logo.svg alt=Shiux></a></div></div></div><div id=nexmoe-header><div class="nexmoe-drawer mdui-drawer" id=drawer><div class="nexmoe-avatar mdui-ripple"><a href=/ title=Shiux><img src=/logo.svg alt=Shiux alt=Shiux></a></div><div class=nexmoe-count><div><span>æ–‡ç« </span>50</div><div><span>æ ‡ç­¾</span>38</div><div><span>åˆ†ç±»</span>7</div></div><div class="nexmoe-list mdui-list" mdui-collapse="{accordion: true}"><a class="nexmoe-list-item mdui-list-item mdui-ripple false" href=/ title=å›åˆ°é¦–é¡µ><i class="mdui-list-item-icon nexmoefont icon-home"></i><div class=mdui-list-item-content>å›åˆ°é¦–é¡µ</div></a><a class="nexmoe-list-item mdui-list-item mdui-ripple false" href=/archive.html title=æ–‡ç« å½’æ¡£><i class="mdui-list-item-icon nexmoefont icon-container"></i><div class=mdui-list-item-content>æ–‡ç« å½’æ¡£</div></a><a class="nexmoe-list-item mdui-list-item mdui-ripple false" href=/about.html title=å…³äºåšä¸»><i class="mdui-list-item-icon nexmoefont icon-info-circle"></i><div class=mdui-list-item-content>å…³äºåšä¸»</div></a></div><aside id=nexmoe-sidebar><div class=nexmoe-widget-wrap><div class="nexmoe-widget nexmoe-social"><a class=mdui-ripple href=https://github.com/shiucs/ target=_blank mdui-tooltip="{content: 'GitHub'}" style=color:#191717;background-color:rgba(25,23,23,.1)><i class="nexmoefont icon-github"></i> </a><a class=mdui-ripple href=https://www.zhihu.com/people/fungyua target=_blank mdui-tooltip="{content: 'çŸ¥ä¹'}" style=color:#1e88e5;background-color:rgba(30,136,229,.1)><i class="nexmoefont icon-zhihu"></i></a></div></div><div class=nexmoe-widget-wrap><h3 class=nexmoe-widget-title>æ–‡ç« åˆ†ç±»</h3><div class=nexmoe-widget><ul class=category-list><li class=category-list-item><a class=category-list-link href=/categories/Code/ >Code</a> <span class=category-list-count>21</span></li><li class=category-list-item><a class=category-list-link href=/categories/Guide/ >Guide</a> <span class=category-list-count>12</span></li><li class=category-list-item><a class=category-list-link href=/categories/Linux/ >Linux</a> <span class=category-list-count>5</span></li><li class=category-list-item><a class=category-list-link href=/categories/MacOS/ >MacOS</a> <span class=category-list-count>5</span></li><li class=category-list-item><a class=category-list-link href=/categories/NetWork/ >NetWork</a> <span class=category-list-count>2</span></li><li class=category-list-item><a class=category-list-link href=/categories/UX/ >UX</a> <span class=category-list-count>1</span></li><li class=category-list-item><a class=category-list-link href=/categories/Windows/ >Windows</a> <span class=category-list-count>4</span></li></ul></div></div><div class=nexmoe-widget-wrap><div id=randomtagcloud class="nexmoe-widget tagcloud nexmoe-rainbow"><a href=/tags/APP/ style=font-size:12.86px>APP</a> <a href=/tags/AdGuard/ style=font-size:11.43px>AdGuard</a> <a href=/tags/Aria2/ style=font-size:10px>Aria2</a> <a href=/tags/CentOS/ style=font-size:12.86px>CentOS</a> <a href=/tags/Cloud/ style=font-size:10px>Cloud</a> <a href=/tags/DNS/ style=font-size:10px>DNS</a> <a href=/tags/Docker/ style=font-size:11.43px>Docker</a> <a href=/tags/FastAPI/ style=font-size:10px>FastAPI</a> <a href=/tags/Git/ style=font-size:11.43px>Git</a> <a href=/tags/HTML/ style=font-size:11.43px>HTML</a> <a href=/tags/Hackintosh/ style=font-size:11.43px>Hackintosh</a> <a href=/tags/Hexo/ style=font-size:11.43px>Hexo</a> <a href=/tags/IP/ style=font-size:11.43px>IP</a> <a href=/tags/Issue/ style=font-size:11.43px>Issue</a> <a href=/tags/JavaScript/ style=font-size:14.29px>JavaScript</a> <a href=/tags/JetBrains/ style=font-size:10px>JetBrains</a> <a href=/tags/Linux/ style=font-size:10px>Linux</a> <a href=/tags/MacOS/ style=font-size:10px>MacOS</a> <a href=/tags/MySQL/ style=font-size:11.43px>MySQL</a> <a href=/tags/NGINX/ style=font-size:10px>NGINX</a> <a href=/tags/NextCloud/ style=font-size:11.43px>NextCloud</a> <a href=/tags/Nodejs/ style=font-size:14.29px>Nodejs</a> <a href=/tags/PHP/ style=font-size:12.86px>PHP</a> <a href=/tags/PIP/ style=font-size:10px>PIP</a> <a href=/tags/Powershell/ style=font-size:10px>Powershell</a> <a href=/tags/SQLAlchemy/ style=font-size:10px>SQLAlchemy</a> <a href=/tags/SSH/ style=font-size:10px>SSH</a> <a href=/tags/Spider/ style=font-size:17.14px>Spider</a> <a href=/tags/Ubuntu/ style=font-size:11.43px>Ubuntu</a> <a href=/tags/npm/ style=font-size:11.43px>npm</a> <a href=/tags/Code/ style=font-size:12.86px>ä»£ç </a> <a href=/tags/FrontEnd/ style=font-size:11.43px>å‰ç«¯</a> <a href=/tags/Consult/ style=font-size:15.71px>å’¨è¯¢</a> <a href=/tags/Skill/ style=font-size:20px>æŠ€å·§</a> <a href=/tags/Note/ style=font-size:18.57px>ç¬”è®°</a> <a href=/tags/Terminal/ style=font-size:14.29px>ç»ˆç«¯</a> <a href=/tags/DSM/ style=font-size:10px>ç¾¤æ™–</a> <a href=/tags/Sources/ style=font-size:10px>è½¯ä»¶æº</a></div><script>for(var maxTagcloud=parseInt(17),tags_length=parseInt(38),tags_arr=[],i=0;i<tags_length;i++)tags_arr.push(i);tags_arr.sort(function(a,t){return.5<Math.random()?-1:1});for(var tags_arr=tags_arr.slice(0,maxTagcloud<tags_length?tags_length-maxTagcloud:0),tag_i=0;tag_i<tags_arr.length;tag_i++)document.getElementById("randomtagcloud").children[tags_arr[tag_i]].style.display="none"</script></div><div class=nexmoe-widget-wrap><h3 class=nexmoe-widget-title>ä¸€è¨€</h3><div class=nexmoe-widget><ul class=hitokoto-box><li id=hitokoto_text_parent class=hitokoto-text hitokotocategory=""><a href=# id=hitokoto_text></a> <a href=# id=hitokoto_error_text style=display:none></a></li></ul></div></div><script>let hitokotoText=document.getElementById("hitokoto_text"),hitokotoErroText=document.getElementById("hitokoto_error_text"),hitokotoCategory=document.getElementById("hitokoto_text_parent").getAttribute("hitokotoCategory");window.addEventListener("load",function(){let t="https://v1.hitokoto.cn";hitokotoCategory&&(t+="?c="+hitokotoCategory),fetch(t).then(t=>t.json()).then(t=>{hitokotoText.innerText="ã€Œ "+t.hitokoto+" ã€ from "+t.from,hitokotoText.href="https://hitokoto.cn/?uuid="+t.uuid}).catch(t=>{console.error(11,t),hitokotoText.style.display="none",hitokotoErroText.style.display="block"})})</script><div class=nexmoe-widget-wrap><h3 class=nexmoe-widget-title>æ–‡ç« å½’æ¡£</h3><div class=nexmoe-widget><ul class=archive-list><li class=archive-list-item><a class=archive-list-link href=/archives/2023/ >2023</a><span class=archive-list-count>9</span></li><li class=archive-list-item><a class=archive-list-link href=/archives/2022/ >2022</a><span class=archive-list-count>2</span></li><li class=archive-list-item><a class=archive-list-link href=/archives/2021/ >2021</a><span class=archive-list-count>18</span></li><li class=archive-list-item><a class=archive-list-link href=/archives/2020/ >2020</a><span class=archive-list-count>20</span></li><li class=archive-list-item><a class=archive-list-link href=/archives/2019/ >2019</a><span class=archive-list-count>1</span></li></ul></div></div><div class=nexmoe-widget-wrap><h3 class=nexmoe-widget-title>æœ€æ–°æ–‡ç« </h3><div class=nexmoe-widget><ul><li><a href=/article/python-pip-issue/ >ä¿®æ”¹äº† Python å®‰è£…ç›®å½•çš„æ–‡ä»¶å¤¹åç§°è€Œæ— æ³•ä½¿ç”¨ pip çš„ä¸¤ç§å®ç”¨è§£å†³æ–¹æ³•</a></li><li><a href=/article/python-fastapi-sqlalchemy/ >Python FastAPI æ¡†æ¶é…åˆ SQLAlchemy æ“ä½œ Mysql æ•°æ®åº“ å¢åˆ æ”¹æŸ¥</a></li><li><a href=/article/powershell-perfect-setup/ >Powershell å®Œç¾é…ç½®</a></li><li><a href=/article/hackintosh-one-key-hidip/ >é»‘è‹¹æœä¸€é”® HiDPI</a></li><li><a href=/article/say-no-to-meta-keywords/ >Meta Keywordsï¼šæ˜¯ä»€ä¹ˆã€ä¸ºä»€ä¹ˆä¸</a></li></ul></div></div></aside><div class=nexmoe-copyright>&copy; 2023 Shiux Powered by <a href=http://hexo.io/ target=_blank>Hexo</a> & <a href=https://github.com/theme-nexmoe/hexo-theme-nexmoe target=_blank>Nexmoe</a></div></div></div><div id=nexmoe-content><div class=nexmoe-primary><div class=nexmoe-post><article><div class=nexmoe-post-cover><img src="https://api.btstu.cn/sjbz/api.php?lx=dongman&format=images" alt="ä½¿ç”¨ Docker æ­å»º Mastodon" loading=lazy><h1>ä½¿ç”¨ Docker æ­å»º Mastodon</h1></div><div class=nexmoe-post-meta><div class=nexmoe-rainbow><a class="nexmoefont icon-calendar-fill">2021å¹´08æœˆ28æ—¥</a> <a class="nexmoefont icon-appstore-fill -link" href=/categories/Code/ >Code</a> <a><i class="nexmoefont icon-areachart"></i>çº¦4.7kå­—</a> <a><i class="nexmoefont icon-time-circle-fill"></i>é¢„è®¡éœ€è¦19åˆ†é’Ÿ</a></div></div><h2 id=ä¸ºä»€ä¹ˆå¼€å§‹ä½¿ç”¨Dockeræ­å»ºå®ä¾‹>ä¸ºä»€ä¹ˆå¼€å§‹ä½¿ç”¨ Docker æ­å»ºå®ä¾‹</h2><p>å¼€å§‹ä½¿ç”¨ Docker çº¯å±ä¸€ä¸ªæ‰‹æ®‹æ„å¤–å¯¼è‡´çš„é˜´å·®é˜³é”™ï¼šæˆ‘ä¸å°å¿ƒåœ¨å‡çº§æ—¶æŒ‰äº† DigitalOcean é¢æ¿é‡Œçš„ â€œå…³é—­æœåŠ¡å™¨â€ æŒ‰é’®ï¼Œç›¸å½“äºè·‘ç€ç¨‹åºçªç„¶æ‹”äº†ä¸»æœºç”µæºï¼Œå¯¼è‡´æ•´ä¸ªæœåŠ¡å™¨å‡ºç°å¤§å‹ç½¢å·¥ã€‚æœ€åç”±å…”å­å¸®ï¼ˆä»£ï¼‰åŠ©ï¼ˆåŠ³ï¼‰æˆ‘è¿ç§»äº†ç«™ç‚¹ï¼Œæ–¹ä¾¿èµ·è§éƒ¨ç½²åœ¨äº† Docker ä¸Šã€‚äºæ˜¯åœ¨æ­¤ä¹Ÿæé†’å„ä½ï¼Œæƒ³è¦å…³é—­ Mastodon æœåŠ¡ï¼Œä¸€å®šè¦ä½¿ç”¨ <code>systemctl stop å…·ä½“æœåŠ¡ï¼ˆmastodon-sidekiqã€mastodon-webä»¥åŠmastodon-streamingï¼‰</code>çš„æ–¹æ³•ï¼Œåƒä¸‡ä¸è¦ç¡¬å…³ã€‚</p><p>åœ¨ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´çš„ Docker ä¹‹åï¼Œæˆ‘æ€»ç»“å‡ºä»¥ä¸‹ Docker æ­å»ºçš„ä¼˜ç¼ºç‚¹ï¼š</p><h3 id=ä¼˜ç‚¹>ä¼˜ç‚¹</h3><ol><li>æ­å»ºã€å‡çº§æ–¹ä¾¿ï¼Œå‘½ä»¤ç®€å•ï¼Œä¸ç”¨è‡ªè¡Œé…ç½®ç¯å¢ƒï¼Œæ¯”èµ·ç”¨å®˜æ–¹æ–‡æ¡£å‘½ä»¤è¡Œæ­å»ºè€Œè¨€ï¼Œæ›´é€‚åˆæ–°æ‰‹ã€‚</li><li>å¯¹å†…å­˜è¾ƒå°çš„æœåŠ¡å™¨ï¼Œå¯ä»¥å…é™¤æ¯æ¬¡å‡çº§éœ€è¦çš„ç¼–è¯‘ï¼ˆprecompileï¼‰æ­¥éª¤ç»™å°æœºå™¨å¸¦æ¥çš„è´Ÿæ‹…ã€‚</li><li>Mastodon ç«™ç‚¹è¿è¡Œåœ¨ä¸€ä¸ªéš”ç¦»çš„å°ç¯å¢ƒï¼ˆå®¹å™¨ï¼‰ä¸­ï¼Œå®‰å…¨æ€§è¾ƒé«˜ï¼Œä¸æ€•æ–°æ‰‹æ“ä½œæŠŠæ•´ä¸ªç³»ç»Ÿæå´©ï¼Œå‡ºç°é—®é¢˜ä¹‹ååªè¦é‡å¯å³å¯ï¼Œä¼šæŒ‰é•œåƒè‡ªåŠ¨å¤åŸã€‚</li></ol><h3 id=ç¼ºç‚¹>ç¼ºç‚¹</h3><ol><li>å¯ç”¨æ•™ç¨‹è¾ƒå°‘ï¼Œè®¸å¤šå‘½ä»¤éœ€è¦é‡æ–°å­¦èµ·ã€‚</li><li>é­”æ”¹å­—æ•°ç­‰ç›¸å¯¹è€Œè¨€ä¸å¤ªæ–¹ä¾¿ï¼Œéœ€è¦å¢åŠ ä¸€ä¸ªæ­¥éª¤ï¼Œåœ¨ä¹‹åçš„åšæ–‡ä¼šè¯¦ç»†åˆ—å‡ºã€‚</li><li>éœ€è¦å­¦ä¹  docker ç›¸å…³å‘½ä»¤ã€‚</li></ol><p>æ€»ä½“è€Œè¨€ï¼Œå¯¹äºä¸€ä¸ªæ–°æ‰‹ï¼Œdocker ç»´æŠ¤èµ·æ¥ç›¸å¯¹è¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿ï¼ˆçš®å®è€æ“ï¼‰çš„ã€‚å¤§å®¶å¯ä»¥è‡ªè¡Œå†³å®šã€‚ä½†æœç´¢äº’è”ç½‘ï¼Œå®˜æ–¹å¹¶æ²¡æœ‰ç»™å‡º docker çš„æ­å»ºæŒ‡å—ï¼Œè€Œæ°‘é—´æŒ‡å—è¦ä¹ˆè¿‡æ—¶ã€è¦ä¹ˆæœ‰å†—ä½™æ­¥éª¤ä¼šå ç”¨å¤§é‡æ—¶é—´ã€‚å› æ­¤ï¼Œå¸Œæœ›è¿™ç¯‡æ•™ç¨‹èƒ½ç»™å¤§å®¶å¸¦æ¥ä¸€äº›å¸®åŠ©ã€‚</p><h2 id=å¦‚ä½•åœ¨Dockerä¸Šä»å¤´æ­å»ºMastodon>å¦‚ä½•åœ¨ Docker ä¸Šä»å¤´æ­å»º Mastodon</h2><h3 id=è´­ä¹°åŸŸåã€è´­ä¹°æœåŠ¡å™¨ã€é…ç½®SMTPæœåŠ¡>è´­ä¹°åŸŸåã€è´­ä¹°æœåŠ¡å™¨ã€é…ç½® SMTP æœåŠ¡</h3><p>è¿™ä¸‰æ­¥ä¸ºå»ºç«™åŸºç¡€ï¼Œè¯·å¤§å®¶å‚è€ƒæœ¬ç«™<a target=_blank rel=noopener href=https://pullopen.github.io/%E5%9F%BA%E7%A1%80%E6%90%AD%E5%BB%BA/2020/07/19/How-to-build-a-mastodon-instance.html>æœ€æ—©æ•™ç¨‹</a>çš„å‰ 3 æ­¥é€ä¸€å®Œæˆã€‚</p><p>å…¶ä¸­ï¼ŒæœåŠ¡å™¨å¯åœ¨ä»»ä½•ä¸€å®¶æœåŠ¡å™¨æä¾›å•†è´­ä¹°ï¼Œä¸å¿…å±€é™äºï¼ˆä¹Ÿä¸æ¨èï¼‰DigitalOceanã€‚å…¶ä»–å¦‚å›½äººå¸¸ç”¨çš„ Vulturã€Digital Oceanï¼Œæˆ–è€…ä½äºå¾·å›½çš„ Contaboã€Hetzner ç­‰éƒ½å¯ä»¥ã€‚ä½ å¯ä»¥å‚è€ƒ<a target=_blank rel=noopener href=https://www.zhujiceping.com/ >ä¸»æœºæµ‹è¯„ç½‘ç«™</a>è¹²æœåŠ¡å™¨æŠ˜æ‰£ã€‚æ­¤å¤–ï¼Œ<a target=_blank rel=noopener href=https://www.notion.so/68b0e4bb0b9e4fa5a9dd74d03b71a328>O3O ç«™é•¿æ­ç«™æŒ‡å—</a>æœ‰æ›´è¯¦ç»†çš„æŒ‡å¯¼æ„è§ã€‚</p><p>è´­ä¹°æ—¶é€‰æ‹©æ“ä½œç³»ç»Ÿä¸º <strong>Ubuntu æˆ– Debian</strong> å³å¯ã€‚æœ¬æ–‡æ•™ç¨‹å‡ä»¥æ­¤ç³»ç»Ÿä¸ºå‡†ã€‚</p><p>æ— è®ºä½ é€‰æ‹©å“ªå®¶æœåŠ¡å™¨ï¼Œè¯·éƒ½<strong>ä¸è¦ä½¿ç”¨ä½äºå›½å†…çš„æœåŠ¡å™¨</strong>ï¼Œæœ€å¥½<strong>ä¸è¦é€‰æ‹©å›½å†…çš„æœåŠ¡å™¨æä¾›å•†</strong>ï¼Œå¦åˆ™ä½ å¯èƒ½ä¼šé¢ä¸´æ— æ³•ä¸å…¶ä»–ç«™ç‚¹äº’è”äº’é€šã€ç”šè‡³ç«™ç‚¹ä¸‹çº¿çš„é£é™©ã€‚</p><p>Mastodon ç³»ç»Ÿè¾ƒä¸ºåºå¤§ï¼Œå¦‚æœè¿è¡Œä¸€ä¸ªå•äººå®ä¾‹ï¼Œè¯·ä¿è¯å†…å­˜è‡³å°‘åœ¨ 1G ä»¥ä¸Šï¼Œå‚¨å­˜è‡³å°‘åœ¨ 25G ä»¥ä¸Šã€‚å¦‚æœé¢„è®¡ç”¨æˆ·æ•°é‡å¢åŠ ï¼Œè¯·ç›¸åº”å¢åŠ æœåŠ¡å™¨é…ç½®ã€‚</p><h3 id=é…ç½®ç³»ç»Ÿ>é…ç½®ç³»ç»Ÿ</h3><ul><li><p>é…ç½® ssh-keyï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>mkdir</span> -p ~/.ssh<br>nano ~/.ssh/authorized_keys<br></code></pre></td></tr></tbody></table></figure><p>å°†é€šè¿‡å„ç§æ–¹æ³•ï¼ˆå¦‚ Xshellã€PuTTy ç­‰è½¯ä»¶ï¼‰ç”Ÿæˆçš„ ssh-rsa å…¬é’¥ç²˜è´´å…¥å…¶ä¸­ã€‚éšåé€šè¿‡ ssh-key å¯†é’¥æ–¹å¼ç™»å½•ã€‚</p><p>ä¸ºäº†å®‰å…¨ï¼Œå®˜æ–¹æ¨èå°† ssh å¯†ç ç™»å½•æ–¹å¼å…³é—­ï¼ˆä¸å½±å“é€šè¿‡ VNCã€DigitalOcean Console ç­‰æ–¹å¼ç™»å½•ï¼Œ<strong>è¯·ç¡®ä¿æ­¤æ—¶ä½ çš„ SSH æ˜¯ä¾é å¯†é’¥è€Œä¸æ˜¯å¯†ç ç™»å½•ï¼Œå¦åˆ™ä½ è®¾ç½®å®Œæ¯•åä¼šè¢«è¸¢å‡ºå»</strong>ï¼‰ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">nano /etc/ssh/sshd_config<br></code></pre></td></tr></tbody></table></figure><p>æ‰¾åˆ° <code>PasswordAuthentication</code> ä¸€è¡Œï¼Œå°†å…¶å‰é¢çš„ #åˆ æ‰ï¼ˆå–æ¶ˆæ³¨é‡Šï¼‰ï¼Œåœ¨åé¢å°† yes æ”¹æˆ noã€‚</p><p>é‡å¯ sshdï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">systemctl restart sshd<br></code></pre></td></tr></tbody></table></figure></li><li><p>å®‰è£…å¸¸ç”¨å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">apt update &amp;&amp; apt install wget rsync python git curl vim git ufw -y<br></code></pre></td></tr></tbody></table></figure></li><li><p>é…ç½® SWAPï¼Œå…·ä½“è¯·å‚è€ƒ<a target=_blank rel=noopener href=https://www.digitalocean.com/community/tutorials/how-to-add-swap-space-on-ubuntu-16-04>é…ç½® SWAP æ•™ç¨‹</a>ã€‚</p><p>è¯·è®©ä½ çš„å†…å­˜ + SWAP è‡³å°‘è¾¾åˆ° 4G ä»¥ä¸Šã€‚å¯ä»¥åœ¨ root ç”¨æˆ·ä¸‹é€šè¿‡ <code>free -h</code> æŸ¥çœ‹ã€‚</p></li><li><p>é…ç½®é˜²ç«å¢™</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash">sudo ufw allow OpenSSH<br>sudo ufw <span class=hljs-built_in>enable</span><br></code></pre></td></tr></tbody></table></figure><p>æ‰“å¼€é˜²ç«å¢™ï¼Œéšåæ‰“å¼€ 80 å’Œ 443 ç«¯å£ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash">sudo ufw allow http<br>sudo ufw allow https<br></code></pre></td></tr></tbody></table></figure><p>ç„¶åå¯ä»¥é€šè¿‡ <code>sudo ufw status</code> æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ° 80 å’Œ 443 ç«¯å£çš„æ˜¾ç¤ºã€‚</p></li></ul><h3 id=å®‰è£…dockerå’Œdocker-compose>å®‰è£… docker å’Œ docker-compose</h3><p>æ³¨æ„ï¼šè¿™é‡Œç¬¬ä¸€æ­¥ä½¿ç”¨äº†å®˜æ–¹æä¾›çš„ä¸€é”®è„šæœ¬å®‰è£… dockerã€‚å¦‚æœä½ å¯¹æ­¤æ„Ÿåˆ°ä¸æ”¾å¿ƒï¼Œè¯·é€šè¿‡<a target=_blank rel=noopener href=https://docs.docker.com/engine/install/ubuntu/ >å®˜ç½‘æ­¥éª¤</a>è‡ªè¡Œå®‰è£…ï¼ŒåŒæ ·ä¹Ÿæ˜¯å¤åˆ¶ç²˜è´´å‘½ä»¤è¡Œã€‚</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><code class="hljs bash">bash &lt;(curl -L https://get.docker.com/)<br>sudo curl -L <span class=hljs-string>"https://github.com/docker/compose/releases/download/1.27.4/docker-compose-<span class=hljs-subst>$(uname -s)</span>-<span class=hljs-subst>$(uname -m)</span>"</span> -o /usr/local/bin/docker-compose<br>sudo <span class=hljs-built_in>chmod</span> +x /usr/local/bin/docker-compose<br></code></pre></td></tr></tbody></table></figure><h3 id=æ‹‰å–Mastodoné•œåƒï¼ˆ2022-04-25ä¿®æ”¹>æ‹‰å– Mastodon é•œåƒï¼ˆ2022-04-25 ä¿®æ”¹)</h3><ul><li><p>æ‹‰å–é•œåƒ</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>mkdir</span> -p /home/mastodon/mastodon<br><span class=hljs-built_in>cd</span> /home/mastodon/mastodon<br>docker pull tootsuite/mastodon:latest     <span class=hljs-comment>#å¦‚æœéœ€è¦å‡çº§åˆ°æŸç¨³å®šç‰ˆæœ¬ï¼Œè¯·å°†latestæ”¹æˆv3.5.1ç­‰ç‰ˆæœ¬å·ã€‚</span><br>wget https://raw.githubusercontent.com/tootsuite/mastodon/master/docker-compose.yml<br></code></pre></td></tr></tbody></table></figure></li><li><p>ä¿®æ”¹ <code>docker-compose.yml</code> é…ç½®æ–‡ä»¶</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">nano docker-compose.yml<br></code></pre></td></tr></tbody></table></figure><p>ä¾æ¬¡æ‰¾åˆ° <code>web</code>ã€<code>streaming</code>ã€<code>sidekiq</code> åˆ†ç±»ï¼Œåœ¨æ¯ä¸€ç±»çš„ <code>image: tootsuite/mastodon</code> åæ·»åŠ <code>:latest</code> æˆ–è€…ä½ åˆšæ‰æ‹‰å–çš„ç‰ˆæœ¬å·ï¼Œå˜æˆ <code>image: tootsuite/mastodon:latest</code> æˆ– <code>image: tootsuite/mastodon:v3.5.1</code> ç­‰ç­‰ã€‚</p><p>æ­¤å¤–ï¼Œå®˜æ–¹çš„ <code>docker-compose.yml</code> æ–‡ä»¶é‡Œå†™çš„æ˜¯ 7.17.4ï¼Œä½†ç›®å‰ elasticsearch çš„æœ€é«˜ç‰ˆæœ¬ä¸º 7.10.2ï¼Œéœ€è¦ä¿®æ”¹ã€‚</p><p><code>ctrl+X</code> é€€å‡ºä¿å­˜ã€‚</p></li></ul><h3 id=åˆå§‹åŒ–PostgreSQLï¼ˆ2022-04-25ä¿®æ”¹ï¼‰>åˆå§‹åŒ– PostgreSQLï¼ˆ2022-04-25 ä¿®æ”¹ï¼‰</h3><blockquote><p>ï¼ˆåœ¨ v3.5.0 ä»¥åï¼Œè¯·æ³¨æ„ Postgres æ–‡ä»¶å¤¹æ‰€åœ¨ä½ç½®æœ‰æ‰€ä¿®æ”¹ï¼Œä»åŸæœ¬çš„ postgres æ”¹ä¸ºäº† postgres14ã€‚æœ¬æ•™ç¨‹å·²æ›´æ–°ã€‚ï¼‰</p></blockquote><p>åˆšæ‰ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­ï¼Œæ•°æ®åº“ï¼ˆdbï¼‰éƒ¨åˆ†çš„åœ°å€ä¸º<code>./postgres14:/var/lib/postgresql/data</code>ï¼Œå› æ­¤ä½ çš„æ•°æ®åº“ç»å¯¹åœ°å€ä¸º <code>/home/mastodon/mastodon/postgres14</code>ã€‚</p><p>è¿è¡Œï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker run --name postgres14 -v /home/mastodon/mastodon/postgres14:/var/lib/postgresql/data -e   POSTGRES_PASSWORD=è®¾ç½®æ•°æ®åº“ç®¡ç†å‘˜å¯†ç  --<span class=hljs-built_in>rm</span> -d postgres:14-alpine<br></code></pre></td></tr></tbody></table></figure><p>æ‰§è¡Œå®Œåï¼Œæ£€æŸ¥ <code>/home/mastodon/mastodon/postgres14</code>ï¼Œåº”è¯¥å‡ºç° postgres ç›¸å…³çš„å¤šä¸ªæ–‡ä»¶ï¼Œä¸æ˜¯ç©ºæ–‡ä»¶å¤¹ã€‚</p><p>ç„¶åæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker <span class=hljs-built_in>exec</span> -it postgres14 psql -U postgres<br></code></pre></td></tr></tbody></table></figure><p>è¾“å…¥ï¼š</p><figure class="highlight sql"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs sql"><span class=hljs-keyword>CREATE</span> <span class=hljs-keyword>USER</span> mastodon <span class=hljs-keyword>WITH</span> PASSWORD <span class=hljs-string>'æ•°æ®åº“å¯†ç ï¼ˆæœ€å¥½å’Œæ•°æ®åº“ç®¡ç†å‘˜å¯†ç ä¸ä¸€æ ·ï¼‰'</span> CREATEDB;<br></code></pre></td></tr></tbody></table></figure><p>åˆ›å»º mastodon ç”¨æˆ·ã€‚</p><figure class="highlight sql"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs sql">\q<br></code></pre></td></tr></tbody></table></figure><p>é€€å‡ºæ•°æ®åº“ã€‚</p><p>æœ€ååœæ­¢ dockerï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker stop postgres14<br></code></pre></td></tr></tbody></table></figure><blockquote><p>é™„ï¼šå¦‚æœä½ å‚è€ƒäº† 2020-12-12 ä¹‹å‰çš„æ•™ç¨‹ï¼Œé‚£ä¸ªæ•™ç¨‹æœªå¯¹ postgres è®¾ç½®å¯†ç ï¼Œæœ‰ä¸€å®šçš„å®‰å…¨éšæ‚£ï¼Œè¯·å‚è€ƒæœ¬æ–‡æ–°å¢é™„å½•çœ‹å¦‚ä½•è®¾ç½®å¯†ç ã€‚</p></blockquote><h3 id=é…ç½®Mastodonï¼ˆ2022-11-21ä¿®æ”¹>é…ç½® Mastodonï¼ˆ2022-11-21 ä¿®æ”¹)</h3><ul><li><p>é…ç½®æ–‡ä»¶</p><p>åœ¨ <code>/home/mastodon/mastodon</code> æ–‡ä»¶å¤¹ä¸­åˆ›å»ºç©ºç™½<code>.env.production</code> æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>touch</span> .env.production<br></code></pre></td></tr></tbody></table></figure><p>root ç”¨æˆ·å†…ï¼Œè¿è¡Œ</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker-compose run --<span class=hljs-built_in>rm</span> web bundle <span class=hljs-built_in>exec</span> rake mastodon:setup<br></code></pre></td></tr></tbody></table></figure><p>éšåä¼šå‡ºç°ä¸‹åˆ—é—®é¢˜ï¼ˆæ­¤å¤„å‚è€ƒ<a target=_blank rel=noopener href=https://tech.konata.co/2022-02-10-build-a-mastodon/ >æ­¤æ–¹æ›´æ–°ç‰ˆæ•™ç¨‹</a>ï¼‰ï¼š</p><p>Domain name: ä½ çš„åŸŸå</p><p>Single user mode disables registrations and redirects the landing page to your public profile.</p><p>Do you want to enable single user mode? No</p><p>Are you using Docker to run Mastodon? Yes</p><p>PostgreSQL host: mastodon_db_1</p><p>PostgreSQL port: 5432</p><p>Name of PostgreSQL database: mastodon</p><p>Name of PostgreSQL user: mastodon</p><p>Password of PostgreSQL user: ï¼ˆè¿™é‡Œå†™ä¸Šé¢ä½ ç»™ mastodon è®¾ç½®çš„æ•°æ®åº“å¯†ç ï¼‰</p><p>Database configuration works! ğŸ†</p><p>Redis host: mastodon_redis_1</p><p>Redis port: 6379</p><p>Redis password: ï¼ˆè¿™é‡Œæ˜¯ç›´æ¥å›è½¦ï¼Œæ²¡æœ‰å¯†ç ï¼‰</p><p>Redis configuration works! ğŸ†</p><p>Do you want to store uploaded files on the cloud? è¿™ä¸ªæˆ‘ä»¬å…ˆå¡« Noï¼Œæœªæ¥å†å‚è€ƒ<a target=_blank rel=noopener href=https://pullopen.github.io/%E7%AB%99%E7%82%B9%E7%BB%B4%E6%8A%A4/2020/07/22/Move-mastodon-media-to-Scaleway.html>ä¸Šäº‘æ•™ç¨‹</a>é…ç½®ã€‚</p><p>Do you want to send e-mails from localhost? Noï¼Œç„¶åæ ¹æ®åˆšæ‰é…ç½®çš„é‚®ä»¶æœåŠ¡å¡«å†™ï¼ˆä¸‹æ–‡ä¸ºä¸¾ä¾‹ï¼‰ã€‚</p><p>SMTP server: <a target=_blank rel=noopener href=http://smtp.zoho.eu>smtp.zoho.eu</a></p><p>SMTP port: 587</p><p>SMTP username: ä½ çš„ zoho ç®¡ç†å‘˜é‚®ç®±åœ°å€</p><p>SMTP password: ä½ çš„ zoho ç®¡ç†å‘˜å¯†ç </p><p>SMTP authentication: plain</p><p>SMTP OpenSSL verify mode: none</p><p>E-mail address to send e-mails â€œfromâ€: ä½ çš„ zoho ç®¡ç†å‘˜é‚®ç®±åœ°å€</p><p>Send a test e-mail with this configuration right now? no</p><p>This configuration will be written to .env.production</p><p>Save configuration? Yes</p><p>Below is your configuration, save it to an .env.production file outside Docker:</p><p>ç„¶åä¼šå‡ºç°.env.production é…ç½®ï¼Œ<strong>è¯·åŠ¡å¿…å¤åˆ¶ä¸‹æ¥ï¼Œå…ˆå­˜åˆ°ç”µè„‘é‡Œï¼Œç­‰ä¼šå„¿è¦ç”¨ã€‚</strong></p><p>ä¹‹åä¼šè¦ä½ å»ºç«‹æ•°æ®åº“å’Œç¼–è¯‘ï¼Œéƒ½é€‰æ˜¯ã€‚</p><p><strong>æ›´æ–°ï¼šåœ¨ 4.0.2 ç‰ˆæœ¬ï¼Œå› ä¸ºä¸€äº› bugï¼Œè¯·å…ˆä¸è¦å»ºç«‹ç®¡ç†å‘˜å¸å·ï¼Œç¨åå†ä½¿ç”¨ tootctl å·¥å…·å»ºç«‹ï¼</strong></p><p>ä¸€åˆ‡æˆåŠŸä¹‹åï¼Œè®°å¾—<strong>ç«‹åˆ»é©¬ä¸Šï¼š</strong></p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">nano .env.production<br></code></pre></td></tr></tbody></table></figure><p>æŠŠä½ åˆšæ‰å¤åˆ¶ä¸‹æ¥çš„é…ç½®ä¿å­˜è¿›å»ã€‚</p><p><strong>æ›´æ–°ï¼šåœ¨ 4.0.2 ç‰ˆæœ¬ï¼Œéœ€è¦åœ¨<code>.env.production</code> ä¸­å¢åŠ ä¸€è¡Œï¼š</strong></p><figure class="highlight ini"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs ini"><span class=hljs-attr>REDIS_URL</span>=redis://@mastodon_redis_1:<span class=hljs-number>6379</span><br></code></pre></td></tr></tbody></table></figure></li><li><p>å¯åŠ¨ Mastodon</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash">docker-compose down<br>docker-compose up -d<br></code></pre></td></tr></tbody></table></figure></li><li><p>ä¸ºç›¸åº”æ–‡ä»¶å¤¹èµ‹æƒ</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>chown</span> 991:991 -R ./public<br><span class=hljs-built_in>chown</span> -R 70:70 ./postgres14<br>docker-compose down<br>docker-compose up -d<br></code></pre></td></tr></tbody></table></figure></li></ul><h3 id=å®‰è£…å¹¶é…ç½®nginxï¼ˆ2022-11-21ä¿®æ”¹ï¼‰>å®‰è£…å¹¶é…ç½® nginxï¼ˆ2022-11-21 ä¿®æ”¹ï¼‰</h3><p>åœ¨è¿™ä¸€æ­¥ä¹‹å‰ï¼Œè¯·è®°å¾—åˆ°æ‚¨è´­ä¹°åŸŸåçš„ç½‘ç«™ï¼ˆå¦‚ NameCheapï¼‰ï¼Œåœ¨ DNS è®¾ç½®ä¸­æ·»åŠ ä¸€ä¸ª <strong>A Record</strong>ï¼ŒHost å¡«å†™ @ï¼ˆå¦‚æœæ²¡æœ‰å­åŸŸåéœ€æ±‚ï¼‰ï¼ŒValue å¡«å†™ä½ æœåŠ¡å™¨çš„ IP åœ°å€ï¼Œå°†ä½ è®¾å®šçš„åŸŸåæŒ‡å‘ä½ çš„æœåŠ¡å™¨ã€‚</p><p><strong>è¯·æ³¨æ„ï¼šæ­¤æ—¶ä½ çš„ DNS Setting é‡Œé™¤äº†ä½ åˆšæ‰åœ¨é‚®ç®±é…ç½®å’Œæœ¬æ­¥éª¤ä¸­äº²è‡ªè®¾ç½®çš„å†…å®¹ä¹‹å¤–ï¼Œåˆ«çš„ä»»ä½•ç”±åŸŸåå•†è‡ªåŠ¨ç”Ÿæˆçš„å†…å®¹è¯·éƒ½åˆ å…‰ã€‚</strong></p><ul><li><p>å®‰è£… nginx</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">sudo apt install nginx -y<br></code></pre></td></tr></tbody></table></figure></li><li><p>é…ç½® nginx</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">nano /etc/nginx/sites-available/ä½ çš„åŸŸå<br></code></pre></td></tr></tbody></table></figure><p>ç½‘é¡µæ‰“å¼€ <a target=_blank rel=noopener href=https://raw.githubusercontent.com/mastodon/mastodon/main/dist/nginx.conf>nginx æ¨¡æ¿</a>ï¼Œå°†å…¶ä¸­çš„ example.com æ›¿æ¢æˆè‡ªå·±åŸŸåï¼Œå°† 20 å’Œ 43 è¡Œçš„ <code>/home/mastodon/live/public</code> æ”¹æˆ <code>/home/mastodon/mastodon/public</code>ï¼Œ** æ›´æ–°ï¼š** å¹¶å°† <code>try_files $uri =404;</code> ä¿®æ”¹ä¸º <code>try_files $uri @proxy;</code>ï¼Œå¤åˆ¶åˆ°æœåŠ¡å™¨ä¸­ä¿å­˜ã€‚</p><p>éšåé…ç½®é•œåƒæ–‡ä»¶</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>ln</span> -s /etc/nginx/sites-available/ä½ çš„åŸŸå /etc/nginx/sites-enabled/<br></code></pre></td></tr></tbody></table></figure><p><code>nginx -t</code> æ£€æŸ¥ï¼Œæ— è¯¯åé‡å¯ï¼ˆå¦‚æœæç¤º ssl è¯ä¹¦é—®é¢˜ï¼Œè¯·åœ¨ <code>listen 443 ssl http2;</code>ã€<code>listen [::]:443 ssl http2;</code> ç­‰åŒ…å« ssl çš„è¡Œå‰åŠ  #å·å…ˆè¡Œæ³¨é‡Šæ‰ï¼Œé…ç½®å®Œ ssl è¯ä¹¦åå†æ”¹å›æ¥ï¼‰ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">systemctl reload nginx<br></code></pre></td></tr></tbody></table></figure></li><li><p>é…ç½® SSL è¯ä¹¦</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br></pre></td><td class=code><pre><code class="hljs bash">apt install snapd<br>sudo snap install core; sudo snap refresh core<br>sudo snap install --classic certbot<br>sudo <span class=hljs-built_in>ln</span> -s /snap/bin/certbot /usr/bin/certbot<br>sudo certbot certonly --nginx -d ä½ çš„åŸŸå<br></code></pre></td></tr></tbody></table></figure></li><li><p>é‡å¯ nginx</p><p>é‡æ–°æ‰“å¼€ nginx é…ç½®æ–‡ä»¶ï¼Œå°† <code>ssl_certificate</code> å’Œ <code>ssl_certificate_key</code> ä¸¤è¡Œå‰çš„ #å·ï¼ˆä»¥åŠä½ åˆšæ‰æ·»åŠ çš„ #å·ï¼‰åˆ é™¤ã€‚</p><p><code>nginx -t</code> æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ã€‚</p><p>å¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œåˆ™å¯é‡å¯ nginxï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">systemctl reload nginx<br></code></pre></td></tr></tbody></table></figure></li><li><p>æ£€æŸ¥è¯ä¹¦æ›´æ–°</p><p>æœ€åï¼Œå¯é€šè¿‡</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">certbot renew --dry-run<br></code></pre></td></tr></tbody></table></figure><p>æ£€æŸ¥è¯ä¹¦æ˜¯å¦èƒ½è‡ªåŠ¨æ›´æ–°ã€‚</p></li></ul><p>å¦‚æœä¸æ”¾å¿ƒï¼Œå¯ä»¥å†è‡³ <code>/home/mastodon/mastodon</code> æ–‡ä»¶å¤¹ï¼Œè¿è¡Œ <code>docker-compose up -d</code> é‡å¯ mastodonã€‚é™é™ç­‰å¾…å‡ åˆ†é’Ÿåï¼Œç‚¹å¼€ä½ çš„åŸŸåï¼Œä½ çš„ç«™ç‚¹å°±ä¸Šçº¿å•¦ï¼</p><blockquote><p>æ›´æ–°ï¼šæ­¤æ—¶å¯é€šè¿‡ tootctl å·¥å…·å»ºç«‹ç®¡ç†å‘˜å¸æˆ·</p></blockquote><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker <span class=hljs-built_in>exec</span> mastodon_web_1 tootctl accounts create USERNAME --email EMAIL --confirmed --role Ownerã€€ã€€<br></code></pre></td></tr></tbody></table></figure><h2 id=ç«™ç‚¹ä¸Šçº¿ä¹‹å>ç«™ç‚¹ä¸Šçº¿ä¹‹å</h2><p>åœ¨ç«™ç‚¹ä¸Šçº¿ä¹‹åï¼Œä½ å¯ä»¥ï¼š</p><h3 id=å¼€å¯å…¨æ–‡æœç´¢>å¼€å¯å…¨æ–‡æœç´¢</h3><p>Docker çš„å…¨æ–‡æœç´¢å¼€å¯ååˆ†æ–¹ä¾¿ï¼Œåªéœ€è¦ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>cd</span> /home/mastodon/mastodon<br>nano docker-compose.yml<br></code></pre></td></tr></tbody></table></figure><p>ç¼–è¾‘ <code>docker-compose.yml</code>ï¼Œå»æ‰ <code>es</code> éƒ¨åˆ†å‰æ‰€æœ‰çš„ #å·ï¼Œå¹¶ä¸”å»æ‰ <code>web</code> éƒ¨åˆ†ä¸­ <code>es</code> å‰é¢çš„ #å·ã€‚</p><p><code>nano .env.production</code> ç¼–è¾‘<code>.env.production</code> æ–‡ä»¶ï¼ŒåŠ ä¸Š</p><figure class="highlight ini"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><code class="hljs ini"><span class=hljs-attr>ES_ENABLED</span>=<span class=hljs-literal>true</span><br><span class=hljs-attr>ES_HOST</span>=es<br><span class=hljs-attr>ES_PORT</span>=<span class=hljs-number>9200</span><br></code></pre></td></tr></tbody></table></figure><p>ä¸‰è¡Œï¼Œé‡å¯ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash">docker-compose down<br>docker-compose up -d<br></code></pre></td></tr></tbody></table></figure><p>å¾…æ–‡ä»¶å¤¹ä¸­å‡ºç° elasticsearch æ–‡ä»¶å¤¹åï¼Œèµ‹æƒï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>chown</span> 1000:1000 -R elasticsearch<br></code></pre></td></tr></tbody></table></figure><p>å†æ¬¡é‡å¯ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash">docker-compose down<br>docker-compose up -d<br></code></pre></td></tr></tbody></table></figure><p>å…¨æ–‡æœç´¢å³æ­å»ºå®Œæˆã€‚</p><p>ç„¶å</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker-compose run --<span class=hljs-built_in>rm</span> web bin/tootctl search deploy<br></code></pre></td></tr></tbody></table></figure><p>å»ºç«‹ä¹‹å‰å˜Ÿæ–‡çš„æœç´¢ç´¢å¼•å³å¯ã€‚</p><h3 id=ä¿®æ”¹é…ç½®æ–‡ä»¶>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3><p>å¦‚æœåœ¨ä¹‹åéœ€è¦å†å¯¹.env.production é…ç½®è¿›è¡Œä¿®æ”¹ï¼Œåªéœ€ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>cd</span> /home/mastodon/mastodon<br>nano .env.production<br></code></pre></td></tr></tbody></table></figure><p>è¿›è¡Œç›¸åº”ä¿®æ”¹ï¼Œç„¶å</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash">docker-compose down<br>docker-compose up -d<br></code></pre></td></tr></tbody></table></figure><p>é‡å¯å³å¯ã€‚</p><h3 id=ä½¿ç”¨ç®¡ç†å‘½ä»¤è¡Œ>ä½¿ç”¨ç®¡ç†å‘½ä»¤è¡Œ</h3><p>åœ¨ docker ä¸­ä½¿ç”¨ <a target=_blank rel=noopener href=https://docs.joinmastodon.org/admin/tootctl/ >tootctl ç®¡ç†å‘½ä»¤è¡Œ</a>çš„æ–¹å¼æœ‰ä¸‰ç§ï¼š</p><ul><li><p>è¿›å…¥ docker ç³»ç»Ÿåæ“ä½œ</p><p><code>docker ps</code> æŸ¥çœ‹ä½ çš„å®¹å™¨åå­—ï¼Œå¦‚æœä½ æŒ‰ç…§åˆšæ‰è®¾ç½®ï¼Œé‚£ä½ çš„å®¹å™¨åå­—ä¸€èˆ¬ä¸º mastodon_web_1ã€‚</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>cd</span> /home/mastodon/mastodon<br>docker <span class=hljs-built_in>exec</span> -it mastodon_web_1 /bin/bash    <span class=hljs-comment>#æˆ–è€…å°†â€œmastodon_web_1â€æ›¿æ¢ä¸ºä½ çš„å®¹å™¨åã€‚</span><br></code></pre></td></tr></tbody></table></figure><p>è¿›å…¥ docker ç³»ç»Ÿ mastodon ç”¨æˆ·ï¼Œç„¶ååœ¨å…¶ä¸­è¿›è¡Œç›¸åº”çš„ tootctl æ“ä½œã€‚</p><p>æ³¨ï¼šå¦‚æœéœ€è¦è¿›å…¥ docker ç³»ç»Ÿçš„ root ç”¨æˆ·è¿›è¡Œä¸€äº›è½¯ä»¶å®‰è£…ï¼Œåˆ™éœ€è¾“å…¥ <code>docker exec --user root -it mastodon_web_1 /bin/bash</code>ã€‚</p></li><li><p>åœ¨ /home/mastodon/mastodon æ–‡ä»¶å¤¹æ“ä½œ</p><p>é¦–å…ˆè¿›å…¥ /home/mastodon/mastodonï¼Œç„¶å</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker-compose run --<span class=hljs-built_in>rm</span> web bin/tootctl å…·ä½“å‘½ä»¤<br></code></pre></td></tr></tbody></table></figure><p>è¿›è¡Œæ“ä½œã€‚</p></li><li><p>åœ¨ä»»æ„ä½ç½®æ“ä½œ</p><p>åœ¨ä»»æ„ä½ç½®ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker <span class=hljs-built_in>exec</span> mastodon_web_1 tootctl å…·ä½“å‘½ä»¤<br></code></pre></td></tr></tbody></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™åˆ™å…·ä½“å‘½ä»¤éœ€è¦åŒ…æ‹¬æ‰€æœ‰å¿…é¡»çš„å‚æ•°ï¼Œå¹¶ä¸”å¦‚æœå‘½ä»¤æœ¬èº«ä¼šè¦æ±‚ä½ è¿›è¡Œåç»­è¾“å…¥ï¼Œåˆ™æ— æ³•å®Œæˆï¼ˆæ¯”å¦‚ self-distruct å‘½ä»¤æ— æ³•é€šè¿‡è¯¥æ­¥éª¤å®Œæˆã€‚ï¼‰</p></li><li><p>ä½¿ç”¨è„šæœ¬ç®€åŒ–å‘½ä»¤</p><p>å¯å‚è€ƒ<a target=_blank rel=noopener href=https://blog.tantalum.life/posts/how-to-run-your-mastodon-by-docker/#%E4%BD%BF%E7%94%A8alias%E8%84%9A%E6%9C%AC%E7%BC%A9%E5%86%99tootctl%E5%91%BD%E4%BB%A4>è¿™ç¯‡æ–‡ç« </a>ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>cd</span> /home/mastodon/mastodon<br>nano tootctl.sh<br></code></pre></td></tr></tbody></table></figure><p>ç¼–è¾‘è„šæœ¬å†…å®¹ä¸ºï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br><span class=line>14</span><br><span class=line>15</span><br><span class=line>16</span><br><span class=line>17</span><br><span class=line>18</span><br><span class=line>19</span><br><span class=line>20</span><br><span class=line>21</span><br><span class=line>22</span><br><span class=line>23</span><br><span class=line>24</span><br><span class=line>25</span><br><span class=line>26</span><br><span class=line>27</span><br><span class=line>28</span><br><span class=line>29</span><br><span class=line>30</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-meta>#!/bin/bash</span><br>lpwd=<span class=hljs-variable>$PWD</span><br>mypath=`<span class=hljs-built_in>dirname</span> <span class=hljs-variable>$0</span>`<br><span class=hljs-built_in>cd</span> <span class=hljs-variable>$mypath</span><br><span class=hljs-keyword>if</span> [ <span class=hljs-variable>$#</span> -ge 1 ]<br><span class=hljs-keyword>then</span><br>    <span class=hljs-keyword>case</span> <span class=hljs-variable>$1</span> <span class=hljs-keyword>in</span> <br>    	<span class=hljs-string>"restart"</span><br>    		docker-compose restart<br>    	;;<br>    	<span class=hljs-string>"reload"</span>)<br>    		docker-compose down &amp;&amp; docker-compose up -d<br>    	;;<br>		<span class=hljs-string>"stop"</span>)<br>    		docker-compose down<br>    	;;<br>		<span class=hljs-string>"start"</span>)<br>    		docker-compose up -d<br>    	;;<br>    	<span class=hljs-string>"psql"</span>)<br>    		docker-compose <span class=hljs-built_in>exec</span> db $*<br>    	;;<br>    	*)<br>    		docker-compose run --<span class=hljs-built_in>rm</span> web bin/tootctl $*<br>    	;;<br>	<span class=hljs-keyword>esac</span><br><span class=hljs-keyword>else</span><br>	<span class=hljs-built_in>echo</span> <span class=hljs-string>"please use tootctl help for help"</span><br><span class=hljs-keyword>fi</span><br><span class=hljs-built_in>cd</span> <span class=hljs-variable>$lpwd</span><br></code></pre></td></tr></tbody></table></figure><p>éšåæ‰§è¡Œï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>chmod</span> +x /home/mastodon/mastodon/tootctl.sh<br><span class=hljs-built_in>echo</span> <span class=hljs-string>"alias tootctl='/home/mastodon/mastodon/tootctl.sh' "</span> &gt;&gt; ~/.bashrc <br><span class=hljs-built_in>source</span> ~/.bashrc<br></code></pre></td></tr></tbody></table></figure><p>ä¹‹å tootctl ç›¸å…³å‘½ä»¤å‡å¯åœ¨è¿›å…¥ <code>/home/mastodon/mastodon/</code> åç¼©å†™ä¸º <code>tootctl xxx</code>ï¼Œä¸”æ•°æ®åº“ç›¸å…³å‘½ä»¤ä¹Ÿå¯é€šè¿‡ <code>tootctl psql</code> è¿›å…¥ã€‚</p></li></ul><h3 id=å®šæ—¶æ¸…ç†åª’ä½“æ–‡ä»¶>å®šæ—¶æ¸…ç†åª’ä½“æ–‡ä»¶</h3><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">crontab -e<br></code></pre></td></tr></tbody></table></figure><p>é€‰æ‹©ç¼–è¾‘å™¨ä¸º nano æˆ–è€…ä½ ä¹ æƒ¯çš„ç¼–è¾‘å™¨ï¼Œéšåè¾“å…¥ï¼š</p><figure class="highlight shell"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><code class="hljs shell">20 03    * * 1   docker exec mastodon_web_1 tootctl media remove-orphans<br>20 04    * * 2   docker exec mastodon_web_1 tootctl media remove --days=7<br>20 05    * * 3   docker exec mastodon_web_1 tootctl preview_cards remove<br></code></pre></td></tr></tbody></table></figure><p>å…·ä½“æ¸…ç†æ—¶é—´å¯ä»¥è‡ªå·±è®¾ç½®ï¼ˆå‚è€ƒ <a target=_blank rel=noopener href=https://www.runoob.com/w3cnote/linux-crontab-tasks.html>Crontab æ•™ç¨‹</a>ï¼Œä¸Šè¿°è¡¨ç¤ºåœ¨<strong>æœåŠ¡å™¨æ—¶é—´</strong>å‘¨ä¸€ / äºŒ / ä¸‰ç›¸åº”æ—¶é—´æ‰§è¡Œåª’ä½“æ¸…ç†å‘½ä»¤ã€‚</p><h3 id=å‡çº§>å‡çº§</h3><p>å¦‚æœä½ è¦å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œåªéœ€è¦ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>cd</span> /home/mastodon/mastodon<br>docker pull tootsuite/mastodon:latest     <span class=hljs-comment>#æˆ–è€…å°†latestæ”¹æˆç‰ˆæœ¬å·å¦‚v3.2.1</span><br></code></pre></td></tr></tbody></table></figure><p>å¦‚æœä½ å‡çº§çš„æ˜¯ç‰¹å®šç‰ˆæœ¬ï¼Œåˆ™éœ€è¦ç¼–è¾‘ docker-compose.ymlï¼Œå°† webã€streamingã€sidekiq ä¸‰éƒ¨åˆ†çš„ç‰ˆæœ¬å·æ”¹æˆç›¸åº”ç‰ˆæœ¬ã€‚å¦‚æœæ˜¯ latest åˆ™æ— éœ€æ”¹åŠ¨ã€‚</p><p>ç„¶å</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker-compose up -d<br></code></pre></td></tr></tbody></table></figure><p>å¯åŠ¨ã€‚</p><p>å¦‚æœå®˜æ–¹å‡çº§æç¤ºä¸­åŒ…æ‹¬å…¶ä»–æ­¥éª¤å¦‚ <code>docker-compose run --rm web rails db:migrate</code>ï¼Œåˆ™å¯åœ¨å¯åŠ¨åè¿›è¡Œã€‚</p><p>åœ¨ç¡®è®¤å‡çº§æ²¡é—®é¢˜ä¹‹åï¼Œè¿è¡Œ</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker system prune -a<br></code></pre></td></tr></tbody></table></figure><p>æ¸…é™¤æ—§çš„ docker é•œåƒæ–‡ä»¶ã€‚</p><h3 id=å¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­å‡ºç°äº†ä»»ä½•é—®é¢˜â€¦â€¦>å¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­å‡ºç°äº†ä»»ä½•é—®é¢˜â€¦â€¦</h3><p>å¦‚æœæ²¡æœ‰å¯¹ç«™ç‚¹è¿›è¡Œè¿‡é­”æ”¹ï¼Œåªè¦åœ¨ docker ç³»ç»Ÿå¤–ï¼Œé€šè¿‡</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash">docker-compose down<br>docker-compose up -d<br></code></pre></td></tr></tbody></table></figure><p>è®©ç³»ç»Ÿé€šè¿‡ docker é•œåƒé‡æ–°æ­å»ºå®¹å™¨å³å¯ã€‚</p><h3 id=åˆ©ç”¨Scalewayå¤‡ä»½æ•°æ®åº“>åˆ©ç”¨ Scaleway å¤‡ä»½æ•°æ®åº“</h3><p>æœ¬æ­¥è„šæœ¬ç”±å…”å­å†™å°±ï¼Œæ„Ÿè°¢ taï¼</p><p>é¦–å…ˆï¼Œè¯·æ³¨å†Œ Scalewayï¼Œç”³è¯· tokenï¼Œåˆ›å»º Bucketï¼Œæ­¤ä¸‰æ­¥å¯å‚è€ƒ <a target=_blank rel=noopener href=https://pullopen.github.io/%E7%AB%99%E7%82%B9%E7%BB%B4%E6%8A%A4/2020/07/22/Move-mastodon-media-to-Scaleway.html>Scaleway ä¸Šäº‘æ•™ç¨‹</a>ã€‚</p><p>æ³¨æ„ï¼šä¸‹æ–‡æåˆ°çš„å¤‡ä»½è„šæœ¬ä¼šè‡ªåŠ¨åˆ é™¤ 7 å¤©ä»¥å‰çš„æ–‡ä»¶ï¼Œå› æ­¤ ** è¯·ä¸ºå¤‡ä»½æ•°æ®åº“å•ç‹¬å»ºç«‹ä¸€ä¸ª bucketï¼Œ** ä¸è¦å’Œåª’ä½“æ–‡ä»¶ä½¿ç”¨åŒä¸€ä¸ª bucketï¼</p><p>åœ¨æœåŠ¡å™¨ä¸­å®‰è£… rclone å’Œ zipï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash">curl https://rclone.org/install.sh | sudo bash<br>apt install zip -y<br></code></pre></td></tr></tbody></table></figure><p>åˆ›å»º rclone é…ç½®æ–‡ä»¶å¤¹</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>mkdir</span> -p  ~/.config/rclone/<br></code></pre></td></tr></tbody></table></figure><p>æ–°å»ºé…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">nano ~/.config/rclone/rclone.conf<br></code></pre></td></tr></tbody></table></figure><p>å¡«å…¥ä¸‹åˆ—å†…å®¹ï¼š</p><figure class="highlight ini"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br></pre></td><td class=code><pre><code class="hljs ini"><span class=hljs-section>[scaleway]</span><br><span class=hljs-attr>type</span> = s3<br><span class=hljs-attr>provider</span> = Scaleway<br><span class=hljs-attr>access_key_id</span> = ä½ çš„ACCESS KEY<br><span class=hljs-attr>secret_access_key</span> = ä½ çš„SECRET KEY<br><span class=hljs-attr>region</span> = nl-amsï¼ˆæ ¹æ®ä½ bucketé€‰æ‹©çš„åœ°åŒºï¼Œæ³•å›½fr-parï¼Œè·å…°nl-amsï¼Œæ³¢å…°pl-wawï¼‰<br><span class=hljs-attr>endpoint</span> = s3.nl-ams.scw.cloud  ï¼ˆåŒä¸Šï¼‰<br><span class=hljs-attr>acl</span> = private<br></code></pre></td></tr></tbody></table></figure><p>ä¿å­˜ã€‚</p><p>ç„¶ååˆ›å»ºè„šæœ¬</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">nano /backup.sh<br></code></pre></td></tr></tbody></table></figure><p>è¾“å…¥</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br><span class=line>4</span><br><span class=line>5</span><br><span class=line>6</span><br><span class=line>7</span><br><span class=line>8</span><br><span class=line>9</span><br><span class=line>10</span><br><span class=line>11</span><br><span class=line>12</span><br><span class=line>13</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-meta>#!/bin/bash</span><br><span class=hljs-built_in>source</span> /etc/profile<br>now=$(<span class=hljs-built_in>date</span> <span class=hljs-string>"+%Y%m%d-%H%M%S"</span>)<br>origin=<span class=hljs-string>"/home/mastodon/mastodon"</span><br>target=<span class=hljs-string>"scaleway:ä½ çš„bucketåå­—"</span><br><span class=hljs-built_in>echo</span> `<span class=hljs-built_in>date</span> +<span class=hljs-string>"%Y-%m-%d %H:%M:%S"</span>` <span class=hljs-string>" now starting export"</span><br>/usr/bin/docker <span class=hljs-built_in>exec</span> pgå®¹å™¨å pg_dump -U postgres -Fc mastodon_production &gt; <span class=hljs-variable>${origin}</span>/backup.dump &amp;&amp;<br><span class=hljs-built_in>echo</span> `<span class=hljs-built_in>date</span> +<span class=hljs-string>"%Y-%m-%d %H:%M:%S"</span>` <span class=hljs-string>" succeed and upload to s3 now"</span><br>/usr/bin/zip -P å¯†ç  <span class=hljs-variable>${origin}</span>/backup_<span class=hljs-variable>${now}</span>.zip <span class=hljs-variable>${origin}</span>/backup.dump &amp;&amp;<br>/usr/bin/rclone copy <span class=hljs-variable>${origin}</span>/backup_<span class=hljs-variable>${now}</span>.zip <span class=hljs-variable>${target}</span> &amp;&amp;<br><span class=hljs-built_in>echo</span> `<span class=hljs-built_in>date</span> +<span class=hljs-string>"%Y-%m-%d %H:%M:%S"</span>` <span class=hljs-string>" ok all done"</span><br><span class=hljs-built_in>rm</span> -f <span class=hljs-variable>${origin}</span>/backup.dump <span class=hljs-variable>${origin}</span>/backup_<span class=hljs-variable>${now}</span>.zip<br>/usr/bin/rclone --min-age 7d  delete <span class=hljs-variable>${target}</span><br></code></pre></td></tr></tbody></table></figure><p>pg å®¹å™¨åä¸€èˆ¬ä¸º mastodon_db_1ï¼ˆé€šè¿‡ docker ps æŸ¥çœ‹ï¼‰ï¼Œå¯†ç ä¸ºä½ è®¾ç«‹çš„è§£å‹å¯†ç ã€‚mastodon_production ä¸ºä½ çš„æ•°æ®åº“åï¼Œå¯è‡³<code>.env.production</code> æŸ¥çœ‹ã€‚</p><p>ä¿å­˜ã€‚</p><p>èµ‹æƒï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash"><span class=hljs-built_in>chmod</span> 751 /backup.sh<br></code></pre></td></tr></tbody></table></figure><p>ç„¶åï¼Œ</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">/backup.sh<br></code></pre></td></tr></tbody></table></figure><p>è¯•è¿è¡Œä¸€ä¸‹ï¼Œçœ‹çœ‹ Scaleway ä¸­æœ‰æ²¡æœ‰ zip æ–‡ä»¶ç”Ÿæˆã€‚å¦‚æœå‡ºç° zip æ–‡ä»¶ä¸”å¤§å°ä»¥ mb è®¡ç®—ï¼Œåˆ™æˆåŠŸã€‚</p><p>ä¹‹åå¦‚æœæƒ³é€šè¿‡å¤‡ä»½æ–‡ä»¶æ¢å¤ï¼Œåˆ™å¯å‚è€ƒ<a target=_blank rel=noopener href=https://pullopen.github.io/%E7%AB%99%E7%82%B9%E7%BB%B4%E6%8A%A4/2020/10/21/migrate-Mastodon-to-Docker.html>è¿ç§»æ•™ç¨‹</a>ã€‚</p><p>éšåï¼Œè®¾ç½®å®šæ—¶ä»»åŠ¡ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">crontab -e<br></code></pre></td></tr></tbody></table></figure><p>é€‰æ‹© nano ç¼–è¾‘å™¨ï¼Œ</p><figure class="highlight shell"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs shell">3 22    * * *   /backup.sh &gt;&gt; /backup.log<br></code></pre></td></tr></tbody></table></figure><p>å…·ä½“æ—¶é—´è‡ªå·±è®¾ç½®ï¼Œå»ºè®®è®¾ç½®åœ¨åŠå¤œï¼Œæ³¨æ„æœåŠ¡å™¨æ—¶åŒºï¼ˆé€šè¿‡ <code>date</code> æŸ¥çœ‹æœåŠ¡å™¨æ—¶é—´ï¼‰ã€‚</p><h3 id=åˆ©ç”¨Cloudflareæå‡ç½‘ç«™é€Ÿåº¦>åˆ©ç”¨ Cloudflare æå‡ç½‘ç«™é€Ÿåº¦</h3><p>è¯·æ³¨æ„ï¼ŒCloudflare ç›®å‰åœ¨å¤§é™†ä¹Ÿæ—¶å¸¸è¢«é˜»æ‹¦ï¼Œæœªå¿…èƒ½èµ·åˆ°åŠ é€Ÿä½œç”¨ã€‚æ˜¯å¦èƒ½æé«˜é€Ÿåº¦ï¼Œéœ€è¦æ ¹æ®æœåŠ¡å™¨æœ¬èº«çš„åœ¨å¤§é™†çš„è¿æ¥é€Ÿåº¦åˆ¤æ–­ã€‚</p><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p><p>åˆ° <a target=_blank rel=noopener href=https://www.cloudflare.com/ >Cloudflare å®˜ç½‘</a>æ³¨å†Œè´¦å·ï¼Œé€‰æ‹© Add Website è¾“å…¥ä½ è‡ªå·±çš„åŸŸåï¼ŒCloudflare ä¼šè‡ªåŠ¨è¯»å–ä½ çš„ DNS è®°å½•å¹¶ä¸”è¦æ±‚ä½ ä¿®æ”¹åŸŸåæœåŠ¡å™¨ï¼ˆNameServerï¼‰ã€‚å¦‚æœä½ æ˜¯ NameCheap ä¸Šè´­ä¹°çš„åŸŸåï¼Œåˆ™ç‚¹å¼€ä½ çš„åŸŸåï¼Œåœ¨ Domain é‚£ä¸€æ ä¸‹é¢é€‰æ‹© Custom DNSï¼Œå¡«å…¥ Cloudflare æä¾›çš„ä¸¤ä¸ª NameServerï¼Œé™é™ç­‰å¾…ç”Ÿæ•ˆå³å¯ã€‚å¦‚æœæ˜¯å…¶ä»–åœ°æ–¹è´­ä¹°çš„åŸŸåï¼ŒCloudflare ä¹Ÿæä¾›äº†ç›¸åº”<a target=_blank rel=noopener href=https://support.cloudflare.com/hc/zh-cn/articles/205195708-%E5%B0%86%E6%82%A8%E7%9A%84%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%9B%B4%E6%94%B9%E4%B8%BA-Cloudflare>æ•™ç¨‹</a>ï¼Œé€šå¸¸éå¸¸ç®€å•å°±èƒ½å®Œæˆã€‚</p><p><img onerror=imgOnError(this) data-fancybox=gallery src=https://s1.ax1x.com/2020/07/22/U7oZrR.png alt=NameCheapè®¾ç½® data-caption=NameCheapè®¾ç½® loading=lazy></p><p>ç”Ÿæ•ˆä¹‹åä¼šæœ‰é‚®ä»¶é€šçŸ¥ï¼Œè¿™æ—¶æ‰“å¼€ Cloudflareï¼Œè¿›å…¥ä½ çš„åŸŸåã€‚</p><p>ç‚¹å¼€ â€œé€Ÿåº¦ / Speed - ä¼˜åŒ–â€ï¼Œä¸‹å›¾ Auto Minify çš„ä¸‰ä¸ªå‹¾å‹¾è¯·å‹¿é€‰ä¸Šã€‚</p><p><img onerror=imgOnError(this) data-fancybox=gallery src=https://s1.ax1x.com/2020/07/22/U7TYpF.png alt=AutoMinify data-caption=AutoMinify loading=lazy></p><blockquote><p>æ³¨æ„ï¼ˆ2020-12-01 æ›´æ–°ï¼‰ï¼šAuto Minify åœ¨ 3.3.0 ç‰ˆæœ¬ä¹‹åä¼šå½±å“ç½‘é¡µæ‰“å¼€ï¼Œè¯·å‹¿å‹¾é€‰ï¼</p></blockquote><p>åŒæ—¶<strong>è¯·æ³¨æ„</strong>ï¼Œ<strong>Rocket Loaderâ„¢</strong>è¿™ä¸ªå¼€å…³ï¼Œè¯·åŠ¡å¿…ç¡®ä¿å®ƒ<strong>å…³é—­</strong>ï¼Œå¦åˆ™ä½ çš„ Mastodon ä¼šå˜æˆç™½å±ã€‚</p><p><img onerror=imgOnError(this) data-fancybox=gallery src=https://s1.ax1x.com/2020/07/22/U7T79S.png alt=RocketLoader data-caption=RocketLoader loading=lazy></p><p>æ‰“å¼€ <strong>SSL è®¾ç½®</strong>ï¼Œå°†æ¨¡å¼æ”¹æˆ Full / å®Œå…¨ï¼š</p><p><img onerror=imgOnError(this) data-fancybox=gallery src=https://s1.ax1x.com/2020/07/23/UXkujS.png alt=SSLSetting data-caption=SSLSetting loading=lazy></p><p>ç°åœ¨è¯·æ‰“å¼€æµ‹è¯•ï¼Œæ‚¨çš„ç½‘ç«™é€Ÿåº¦æœ‰æ²¡æœ‰å˜å¿«ï¼Ÿæ¯ä¸ªäººæ¯ä¸ªåœ°åŒºæƒ…å†µå¯èƒ½ä¸åŒï¼Œå¯¹æˆ‘è€Œè¨€ç¡®å®æœ‰è‚‰çœ¼å¯è§çš„é€Ÿåº¦æå‡ï¼Œå¯¹äºå„ä½å¯èƒ½éœ€è¦æµ‹è¯•ã€‚å¦‚æœé€Ÿåº¦åè€Œå˜æ…¢ï¼Œå¯ä»¥ç›´æ¥åœ¨ Cloudflare çš„ DNS è®¾å®šä¸­å°†æ©˜è‰²çš„äº‘æœµæŒ‰ç°ï¼Œå³å¯å–æ¶ˆä»£ç†ã€‚</p><p>æ›´è¯¦ç»†çš„è®¾ç½®å¯ä»¥å‚è§ <strong><a target=_blank rel=noopener href=https://guide.mastodon.im/cloudflare>O3O æ­ç«™æŒ‡å—</a></strong>ã€‚</p><h3 id=é™„ï¼šå¦‚ä½•ä¿®æ”¹æ•°æ®åº“å¯†ç ï¼ˆ2022-04-25æ›´æ–°ï¼‰>é™„ï¼šå¦‚ä½•ä¿®æ”¹æ•°æ®åº“å¯†ç ï¼ˆ2022-04-25 æ›´æ–°ï¼‰</h3><p>å¦‚æœåœ¨ 2020-12-12 å‰å‚è€ƒæœ¬æ•™ç¨‹ï¼Œå½“æ—¶æœ¬æ•™ç¨‹æœªè¦æ±‚å¤§å®¶è®¾ç½®æ•°æ®åº“å¯†ç ï¼Œè¿™æ ·åšæœ‰ä¸€å®šçš„å®‰å…¨é£é™©ã€‚å› æ­¤ï¼Œå¦‚æœä½ <strong>å·²ç»å»ºç«™å®Œæ¯•ä¸”æœªè®¾ç½®æ•°æ®åº“å¯†ç </strong>ï¼Œè¯·å‚è€ƒæœ¬æ®µæ·»åŠ æ•°æ®åº“å¯†ç ã€‚</p><p>å…³é—­ mastodon æœåŠ¡ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs bash">docker-compose down<br></code></pre></td></tr></tbody></table></figure><p><code>nano docker-compose.yml</code> ä¿®æ”¹ï¼Œå°†ä¹‹å‰æ•™ç¨‹è¦æ±‚ä½ è®¾ç½®çš„</p><figure class="highlight yaml"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs yaml"><span class=hljs-attr>environment:</span><br>  <span class=hljs-bullet>-</span> <span class=hljs-string>POSTGRES_HOST_AUTH_METHOD=trust</span><br></code></pre></td></tr></tbody></table></figure><p>åˆ æ‰ï¼Œä¿å­˜ã€‚</p><p><code>nano .env.production</code> ä¿®æ”¹ï¼Œæ·»åŠ </p><figure class="highlight ini"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br></pre></td><td class=code><pre><code class="hljs ini"><span class=hljs-attr>DB_PASS</span>=æ•°æ®åº“å¯†ç <br></code></pre></td></tr></tbody></table></figure><p>ä¿å­˜ã€‚</p><p>å¯åŠ¨æ•°æ®åº“å¹¶è¿›å…¥ psql æ¨¡å¼ï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash">docker run --name postgres14 -v /home/mastodon/mastodon/postgres14:/var/lib/postgresql/data --<span class=hljs-built_in>rm</span>  -d  postgres:14-alpine<br>docker <span class=hljs-built_in>exec</span> -it postgres14 psql -U postgres<br></code></pre></td></tr></tbody></table></figure><p>å¡«å…¥ï¼š</p><figure class="highlight sql"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br><span class=line>3</span><br></pre></td><td class=code><pre><code class="hljs sql"><span class=hljs-keyword>alter</span> <span class=hljs-keyword>user</span> mastodon <span class=hljs-keyword>with</span> password <span class=hljs-string>'æ•°æ®åº“å¯†ç '</span>;<br><span class=hljs-keyword>alter</span> <span class=hljs-keyword>user</span> postgres <span class=hljs-keyword>with</span> password <span class=hljs-string>'æ•°æ®åº“ç®¡ç†å‘˜å¯†ç ï¼ˆä¸¤è€…æœ€å¥½ä¸è¦ç›¸åŒï¼‰'</span>;<br>\q<br></code></pre></td></tr></tbody></table></figure><p>åœæ­¢æ•°æ®åº“è¿è¡Œå¹¶å¯åŠ¨ mastodonï¼š</p><figure class="highlight bash"><table><tbody><tr><td class=gutter><pre><span class=line>1</span><br><span class=line>2</span><br></pre></td><td class=code><pre><code class="hljs bash">docker stop postgres14<br>docker-compose up -d<br></code></pre></td></tr></tbody></table></figure><p>æ•°æ®åº“ç®¡ç†å‘˜å¯†ç å’Œæ•°æ®åº“å¯†ç å³æ·»åŠ å®Œæ¯•ã€‚</p><h2 id=æ€»ç»“>æ€»ç»“</h2><p>ä»¥ä¸Šå°±æ˜¯ä»å¤´é€šè¿‡ Docker æ­å»º Mastodon çš„æ–¹æ³•ï¼Œé€šè¿‡å•çº¯å¤åˆ¶ç²˜è´´å¾ˆå¿«å°±èƒ½æ­å»ºå‡ºæ¥ã€‚åœ¨å‡çº§è¿‡ç¨‹ä¸­ä¹Ÿèƒ½å…å»ç¼–è¯‘è¿‡ç¨‹å¯¹å°æœºå™¨é€ æˆçš„è´Ÿæ‹…ã€‚ï¼ˆå½“ç„¶ï¼ŒSWAP è¿˜æ˜¯è¦å¼€çš„ï¼ï¼‰å¦‚æœä½¿ç”¨å®˜æ–¹åˆ†æ”¯ï¼Œå‡çº§åªè¦å‡ åˆ†é’Ÿã€‚</p><p>ç›®å‰ç½‘ç»œä¸Šä¸€äº›å…¶ä»–çš„ docker æ­å»ºæŒ‡å—éƒ½æåˆ°éœ€è¦ docker-compose build è¿™ä¸€æ­¥éª¤ï¼Œå¹¶æ— å¿…è¦ï¼Œä¸”è€—æ—¶é•¿ã€å¯¹æœåŠ¡å™¨å‹åŠ›å¤§ã€‚</p><p>ç„¶åæœ‰æœ‹å‹å°±è¦é—®äº†ï¼šæˆ‘ä¹‹å‰æ˜¯æŒ‰ç…§ DigitalOcean ä¸€é”®é•œåƒæ­å»ºçš„ / ç”¨å®˜æ–¹æ–‡æ¡£å‘½ä»¤è¡Œæ­å»ºçš„ï¼Œæ€ä¹ˆè¿ç§»åˆ° docker ä¸Šå»å‘¢ï¼Ÿå¦‚æœæˆ‘æƒ³å¯¹ä»£ç è¿›è¡Œä¸€ç‚¹æ”¹åŠ¨è¦æ€ä¹ˆåšå‘¢ï¼Ÿè¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å°†åœ¨åç»­çš„æ–‡ç« ä¸­è°ˆåˆ°ã€‚</p></article><div class=nexmoe-post-copyright><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>Shiux<br><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href=https://blog.shiux.com/article/using-docker-to-build-mastodon/ title=https:&#x2F;&#x2F;blog.shiux.com&#x2F;article&#x2F;using-docker-to-build-mastodon&#x2F; target=_blank rel=noopener>https:&#x2F;&#x2F;blog.shiux.com&#x2F;article&#x2F;using-docker-to-build-mastodon&#x2F;</a><br><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬æ–‡é‡‡ç”¨ <a href=https://creativecommons.org/licenses/by-nc-sa/3.0/cn/deed.zh target=_blank>CC BY-NC-SA 3.0 CN</a> åè®®è¿›è¡Œè®¸å¯</div><div class="nexmoe-post-meta nexmoe-rainbow"><a class="nexmoefont icon-tag-fill -none-link" href=/tags/Docker/ rel=tag>Docker</a></div><div class=nexmoe-post-footer><script src=https://giscus.app/client.js data-repo=fungyua/blog-comments data-repo-id="MDEwOlJlcG9zaXRvcnk0MDQ0NTY2OTQ=" data-category=Comments data-category-id=DIC_kwDOGBuE9s4CTUfb data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=light data-lang=zh-CN crossorigin=anonymous async></script></div></div></div><div class=nexmoe-post-right><div class=nexmoe-fixed><div class=nexmoe-tool><button class="mdui-fab catalog" style=overflow:unset><i class="nexmoefont icon-i-catalog"></i><div class=nexmoe-toc><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8Docker%E6%90%AD%E5%BB%BA%E5%AE%9E%E4%BE%8B><span class=toc-number>1.</span> <span class=toc-text>ä¸ºä»€ä¹ˆå¼€å§‹ä½¿ç”¨ Docker æ­å»ºå®ä¾‹</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BC%98%E7%82%B9><span class=toc-number>1.1.</span> <span class=toc-text>ä¼˜ç‚¹</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E7%BC%BA%E7%82%B9><span class=toc-number>1.2.</span> <span class=toc-text>ç¼ºç‚¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E5%A6%82%E4%BD%95%E5%9C%A8Docker%E4%B8%8A%E4%BB%8E%E5%A4%B4%E6%90%AD%E5%BB%BAMastodon><span class=toc-number>2.</span> <span class=toc-text>å¦‚ä½•åœ¨ Docker ä¸Šä»å¤´æ­å»º Mastodon</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E8%B4%AD%E4%B9%B0%E5%9F%9F%E5%90%8D%E3%80%81%E8%B4%AD%E4%B9%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%81%E9%85%8D%E7%BD%AESMTP%E6%9C%8D%E5%8A%A1><span class=toc-number>2.1.</span> <span class=toc-text>è´­ä¹°åŸŸåã€è´­ä¹°æœåŠ¡å™¨ã€é…ç½® SMTP æœåŠ¡</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%85%8D%E7%BD%AE%E7%B3%BB%E7%BB%9F><span class=toc-number>2.2.</span> <span class=toc-text>é…ç½®ç³»ç»Ÿ</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%89%E8%A3%85docker%E5%92%8Cdocker-compose><span class=toc-number>2.3.</span> <span class=toc-text>å®‰è£… docker å’Œ docker-compose</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E6%8B%89%E5%8F%96Mastodon%E9%95%9C%E5%83%8F%EF%BC%882022-04-25%E4%BF%AE%E6%94%B9><span class=toc-number>2.4.</span> <span class=toc-text>æ‹‰å– Mastodon é•œåƒï¼ˆ2022-04-25 ä¿®æ”¹)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%9D%E5%A7%8B%E5%8C%96PostgreSQL%EF%BC%882022-04-25%E4%BF%AE%E6%94%B9%EF%BC%89><span class=toc-number>2.5.</span> <span class=toc-text>åˆå§‹åŒ– PostgreSQLï¼ˆ2022-04-25 ä¿®æ”¹ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%85%8D%E7%BD%AEMastodon%EF%BC%882022-11-21%E4%BF%AE%E6%94%B9><span class=toc-number>2.6.</span> <span class=toc-text>é…ç½® Mastodonï¼ˆ2022-11-21 ä¿®æ”¹)</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%89%E8%A3%85%E5%B9%B6%E9%85%8D%E7%BD%AEnginx%EF%BC%882022-11-21%E4%BF%AE%E6%94%B9%EF%BC%89><span class=toc-number>2.7.</span> <span class=toc-text>å®‰è£…å¹¶é…ç½® nginxï¼ˆ2022-11-21 ä¿®æ”¹ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E7%AB%99%E7%82%B9%E4%B8%8A%E7%BA%BF%E4%B9%8B%E5%90%8E><span class=toc-number>3.</span> <span class=toc-text>ç«™ç‚¹ä¸Šçº¿ä¹‹å</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%BC%80%E5%90%AF%E5%85%A8%E6%96%87%E6%90%9C%E7%B4%A2><span class=toc-number>3.1.</span> <span class=toc-text>å¼€å¯å…¨æ–‡æœç´¢</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BF%AE%E6%94%B9%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6><span class=toc-number>3.2.</span> <span class=toc-text>ä¿®æ”¹é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E4%BD%BF%E7%94%A8%E7%AE%A1%E7%90%86%E5%91%BD%E4%BB%A4%E8%A1%8C><span class=toc-number>3.3.</span> <span class=toc-text>ä½¿ç”¨ç®¡ç†å‘½ä»¤è¡Œ</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%AE%9A%E6%97%B6%E6%B8%85%E7%90%86%E5%AA%92%E4%BD%93%E6%96%87%E4%BB%B6><span class=toc-number>3.4.</span> <span class=toc-text>å®šæ—¶æ¸…ç†åª’ä½“æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%8D%87%E7%BA%A7><span class=toc-number>3.5.</span> <span class=toc-text>å‡çº§</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%A6%82%E6%9E%9C%E5%9C%A8%E6%93%8D%E4%BD%9C%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%87%BA%E7%8E%B0%E4%BA%86%E4%BB%BB%E4%BD%95%E9%97%AE%E9%A2%98%E2%80%A6%E2%80%A6><span class=toc-number>3.6.</span> <span class=toc-text>å¦‚æœåœ¨æ“ä½œè¿‡ç¨‹ä¸­å‡ºç°äº†ä»»ä½•é—®é¢˜â€¦â€¦</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%A9%E7%94%A8Scaleway%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE%E5%BA%93><span class=toc-number>3.7.</span> <span class=toc-text>åˆ©ç”¨ Scaleway å¤‡ä»½æ•°æ®åº“</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E5%88%A9%E7%94%A8Cloudflare%E6%8F%90%E5%8D%87%E7%BD%91%E7%AB%99%E9%80%9F%E5%BA%A6><span class=toc-number>3.8.</span> <span class=toc-text>åˆ©ç”¨ Cloudflare æå‡ç½‘ç«™é€Ÿåº¦</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#%E9%99%84%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AF%86%E7%A0%81%EF%BC%882022-04-25%E6%9B%B4%E6%96%B0%EF%BC%89><span class=toc-number>3.9.</span> <span class=toc-text>é™„ï¼šå¦‚ä½•ä¿®æ”¹æ•°æ®åº“å¯†ç ï¼ˆ2022-04-25 æ›´æ–°ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class=toc-link href=#%E6%80%BB%E7%BB%93><span class=toc-number>4.</span> <span class=toc-text>æ€»ç»“</span></a></li></ol></div></button> <a href=#nexmoe-content class=toc-link aria-label="Back To Top" title=top><button class="mdui-fab mdui-ripple"><i class="nexmoefont icon-caret-top"></i></button></a></div></div></div></div><div id=nexmoe-search-space><div class=search-container><div class=search-header><div class=search-input-container><input class=search-input type=text placeholder=æœç´¢ oninput=sinput()></div><a class=search-close onclick=sclose()>Ã—</a></div><div class=search-body></div></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=G-9MEQVE108T"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-9MEQVE108T")</script></body></html>